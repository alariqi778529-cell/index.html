<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #lock { position: fixed; inset: 0; background: #1a1a1a; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .header { background: #ff4b2b; padding: 15px; text-align: center; font-weight: bold; }
        #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px; border-radius: 15px; max-width: 80%; word-wrap: break-word; }
        .sent { align-self: flex-end; background: #ff4b2b; }
        .rcvd { align-self: flex-start; background: #333; }
        .input-area { padding: 15px; background: #1e1e1e; display: flex; gap: 8px; border-top: 1px solid #333; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: none; background: #333; color: white; outline: none; text-align: center; }
        .btn { background: #ff4b2b; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; }
        .id-display { font-size: 0.8rem; color: #888; padding: 5px; text-align: center; }
    </style>
</head>
<body>

<div id="lock">
    <h2>ğŸ”’ Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² (7777)</h2>
    <input type="password" id="pass" placeholder="7777">
    <br>
    <button class="btn" onclick="unlock()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="header">â¤ï¸ Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</div>
<div id="idShow" class="id-display">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§ØªØµØ§Ù„Ùƒ...</div>

<div id="setup" style="padding: 20px; text-align: center;">
    <input type="text" id="peerIdInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ù‡Ø§ØªÙ Ø­Ø¨ÙŠØ¨ØªÙƒ Ù‡Ù†Ø§">
    <button class="btn" onclick="connectToPeer()">Ø§ØªØµØ§Ù„</button>
</div>

<div id="chat"></div>

<div id="mainChat" class="input-area" style="display: none;">
    <input type="text" id="text" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...">
    <button class="btn" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
let peer, conn;
const PASS = "7777";
const LIMIT = 24 * 60 * 60 * 1000;

function unlock() {
    if(document.getElementById('pass').value === PASS) {
        document.getElementById('lock').style.display='none';
        loadHistory();
        initPeer();
    } else { alert("Ø®Ø·Ø£!"); }
}

function initPeer() {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨Ø³ÙŠØ· Ù„ÙƒÙ„ Ù‡Ø§ØªÙ
    const mySimpleId = 'love-' + Math.floor(1000 + Math.random() * 9000);
    peer = new Peer(mySimpleId);

    peer.on('open', (id) => {
        document.getElementById('idShow').innerText = "Ø±Ù…Ø² Ù‡Ø§ØªÙÙƒ Ù‡Ùˆ: " + id;
    });

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„
    peer.on('connection', (c) => {
        conn = c;
        setupChat();
    });
}

function connectToPeer() {
    const targetId = document.getElementById('peerIdInput').value;
    if(!targetId) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø£ÙˆÙ„Ø§Ù‹");
    conn = peer.connect(targetId);
    setupChat();
}

function setupChat() {
    conn.on('open', () => {
        document.getElementById('setup').style.display = 'none';
        document.getElementById('idShow').innerText = "âœ… Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†";
        document.getElementById('mainChat').style.display = 'flex';
    });
    conn.on('data', data => renderMsg(data, 'rcvd'));
}

function send() {
    const m = document.getElementById('text').value;
    if(conn && m) {
        conn.send(m);
        renderMsg(m, 'sent');
        document.getElementById('text').value = '';
    }
}

function renderMsg(t, type, time = Date.now()) {
    const d = document.createElement('div');
    d.className = 'msg ' + type;
    d.innerText = t;
    document.getElementById('chat').appendChild(d);
    document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
    saveLocal(t, type, time);
}

function saveLocal(t, s, tm) {
    let logs = JSON.parse(localStorage.getItem('chat_final_v10') || '[]');
    if(!logs.find(m => m.tm === tm)) {
        logs.push({t, s, tm});
        localStorage.setItem('chat_final_v10', JSON.stringify(logs));
    }
}

function loadHistory() {
    const now = Date.now();
    let logs = JSON.parse(localStorage.getItem('chat_final_v10') || '[]');
    const filtered = logs.filter(m => (now - m.tm) < LIMIT);
    localStorage.setItem('chat_final_v10', JSON.stringify(filtered));
    filtered.forEach(m => {
        const d = document.createElement('div');
        d.className = 'msg ' + m.s;
        d.innerText = m.t;
        document.getElementById('chat').appendChild(d);
    });
}
</script>
</body>
</html>
