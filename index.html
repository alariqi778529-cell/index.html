<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        #lock { position: fixed; inset: 0; background: #1a1a1a; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .header { background: #ff4b2b; padding: 15px; text-align: center; font-weight: bold; }
        #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px; border-radius: 15px; max-width: 80%; word-wrap: break-word; }
        .sent { align-self: flex-end; background: #ff4b2b; }
        .rcvd { align-self: flex-start; background: #333; }
        .input-area { padding: 15px; background: #1e1e1e; display: flex; gap: 8px; border-top: 1px solid #333; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: none; background: #333; color: white; outline: none; text-align: center; }
        .btn { background: #ff4b2b; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; }
        #setup { padding: 20px; text-align: center; }
        .status { font-size: 0.8rem; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

<div id="lock">
    <h2 style="color: white;">ğŸ”’ Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</h2>
    <input type="password" id="pass" placeholder="7777">
    <br>
    <button class="btn" onclick="unlock()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="header">â¤ï¸ Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</div>

<div id="setup">
    <p>Ø§Ø¯Ø®Ù„Ø§ Ù†ÙØ³ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ© Ø¨Ø¯Ù‚Ø©</p>
    <input type="text" id="room" placeholder="Ù…Ø«Ù„Ø§Ù‹: love2026">
    <button class="btn" id="connectBtn" onclick="start()">Ø±Ø¨Ø· Ø§Ù„Ø§ØªØµØ§Ù„</button>
    <div id="statusLabel" class="status">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡...</div>
</div>

<div id="chat"></div>

<div id="mainChat" class="input-area" style="display: none;">
    <input type="text" id="text" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...">
    <button class="btn" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
let p, c;
const PASS = "7777";
const LIMIT = 24 * 60 * 60 * 1000;

function unlock() {
    if(document.getElementById('pass').value === PASS) {
        document.getElementById('lock').style.display='none';
        loadLogs();
    } else { alert("Ø®Ø·Ø£!"); }
}

function start() {
    const rId = document.getElementById('room').value.trim().toLowerCase();
    if(!rId) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©");
    
    document.getElementById('statusLabel').innerText = "Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±Ø¨Ø·...";
    document.getElementById('connectBtn').disabled = true;

    // Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ ÙƒØ·Ø±Ù Ù…Ù†Ø¶Ù… Ø£ÙˆÙ„Ø§Ù‹
    p = new Peer();
    
    p.on('open', (id) => {
        const conn = p.connect("room-" + rId);
        
        // Ù…Ù‡Ù„Ø© 4 Ø«ÙˆØ§Ù†Ù: Ø¥Ø°Ø§ Ù„Ù… ÙŠØ³ØªØ¬Ø¨ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙˆÙ„ØŒ Ù†ÙØªØ­ Ù†Ø­Ù† Ø§Ù„ØºØ±ÙØ©
        const timeout = setTimeout(() => {
            p.destroy();
            createRoom(rId);
        }, 4000);

        conn.on('open', () => {
            clearTimeout(timeout);
            c = conn;
            setupChat();
        });
    });
}

function createRoom(rId) {
    p = new Peer("room-" + rId);
    p.on('open', () => {
        document.getElementById('statusLabel').innerText = "ØªÙ… ÙØªØ­ Ø§Ù„ØºØ±ÙØ©.. Ø§Ø·Ù„Ø¨ Ù…Ù†Ù‡Ø§ Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø¢Ù†";
    });
    p.on('connection', conn => {
        c = conn;
        setupChat();
    });
    p.on('error', (err) => {
        document.getElementById('statusLabel').innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹";
        document.getElementById('connectBtn').disabled = false;
    });
}

function setupChat() {
    document.getElementById('statusLabel').innerText = "âœ… Ù…ØªØµÙ„Ø§Ù†!";
    document.getElementById('setup').style.display = 'none';
    document.getElementById('mainChat').style.display = 'flex';
    c.on('data', d => renderMsg(d, 'rcvd'));
}

function send() {
    const m = document.getElementById('text').value;
    if(c && m) {
        c.send(m);
        renderMsg(m, 'sent');
        document.getElementById('text').value = '';
    }
}

function renderMsg(t, type, time = Date.now()) {
    const d = document.createElement('div');
    d.className = 'msg ' + type;
    d.innerText = t;
    document.getElementById('chat').appendChild(d);
    document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
    
    let logs = JSON.parse(localStorage.getItem('chat_logs') || '[]');
    logs.push({t, type, time});
    localStorage.setItem('chat_logs', JSON.stringify(logs));
}

function loadLogs() {
    const now = Date.now();
    let logs = JSON.parse(localStorage.getItem('chat_logs') || '[]');
    const filtered = logs.filter(m => (now - m.time) < LIMIT);
    localStorage.setItem('chat_logs', JSON.stringify(filtered));
    filtered.forEach(m => {
        const d = document.createElement('div');
        d.className = 'msg ' + m.type;
        d.innerText = m.t;
        document.getElementById('chat').appendChild(d);
    });
}
</script>
</body>
</html>
