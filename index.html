<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ©</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --main: #ff4b2b; --bg: #121212; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        #lock { position: fixed; inset: 0; background: white; z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #lock input { padding: 12px; border: 2px solid var(--main); border-radius: 25px; text-align: center; margin-bottom: 15px; font-size: 18px; }
        .header { background: var(--main); padding: 15px; text-align: center; font-weight: bold; font-size: 18px; }
        #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 18px; max-width: 75%; font-size: 15px; line-height: 1.4; }
        .sent { align-self: flex-end; background: var(--main); color: white; }
        .rcvd { align-self: flex-start; background: #333; color: #eee; }
        .controls { padding: 15px; background: #1e1e1e; display: flex; gap: 8px; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: none; outline: none; background: #333; color: white; }
        button { background: var(--main); border: none; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 18px; }
    </style>
</head>
<body>

<div id="lock">
    <h2 style="color:black">ğŸ”’ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</h2>
    <input type="password" id="pass" placeholder="7777">
    <button onclick="unlock()" style="width:100px; border-radius:10px">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="header">â¤ï¸ Ù…ÙƒØ§Ù†Ù†Ø§ Ø§Ù„Ø³Ø±ÙŠ â¤ï¸</div>

<div id="chat">
    <div class="msg rcvd">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ.. Ø§Ø¯Ø®Ù„ "Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©" Ø§Ù„Ù…ØªÙÙ‚ Ø¹Ù„ÙŠÙ‡ Ù„Ù†ØªØµÙ„ Ø¨Ø¨Ø¹Ø¶Ù†Ø§.</div>
</div>

<div class="controls">
    <input type="text" id="roomInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø³Ø±ÙŠØ©...">
    <button onclick="startRoom()">ğŸ”—</button>
</div>

<div class="controls" id="msgArea" style="display:none">
    <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§...">
    <button onclick="sendMsg()">âœˆï¸</button>
</div>

<script>
    let peer, conn;
    const PASS = "7777";

    function unlock() {
        if(document.getElementById('pass').value === PASS) document.getElementById('lock').style.display = 'none';
        else alert("Ø®Ø·Ø£!");
    }

    function startRoom() {
        const roomName = "room-" + document.getElementById('roomInput').value;
        if(!roomName) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©");
        
        peer = new Peer(roomName);
        
        peer.on('open', () => {
            appendMsg("ØªÙ… ÙØªØ­ Ø§Ù„ØºØ±ÙØ©: " + document.getElementById('roomInput').value, 'rcvd');
            document.getElementById('roomInput').parentElement.style.display = 'none';
            document.getElementById('msgArea').style.display = 'flex';
        });

        peer.on('connection', (c) => {
            conn = c;
            setupConn();
        });

        peer.on('error', (err) => {
            if(err.type === 'id-taken') { // Ø§Ù„ØºØ±ÙØ© Ù…Ø­Ø¬ÙˆØ²Ø©ØŒ Ù„Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‡Ø§
                peer = new Peer();
                peer.on('open', () => {
                    conn = peer.connect(roomName);
                    setupConn();
                    document.getElementById('roomInput').parentElement.style.display = 'none';
                    document.getElementById('msgArea').style.display = 'flex';
                });
            }
        });
    }

    function setupConn() {
        conn.on('data', data => appendMsg(data, 'rcvd'));
        appendMsg("Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù† Ù…Ø¹ Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø± â¤ï¸", 'rcvd');
    }

    function sendMsg() {
        const m = document.getElementById('msgInput').value;
        if(m && conn) {
            conn.send(m);
            appendMsg(m, 'sent');
            document.getElementById('msgInput').value = '';
        }
    }

    function appendMsg(t, type) {
        const d = document.createElement('div');
        d.className = 'msg ' + type;
        d.innerText = t;
        const c = document.getElementById('chat');
        c.appendChild(d);
        c.scrollTop = c.scrollHeight;
    }
</script>
</body>
</html>
