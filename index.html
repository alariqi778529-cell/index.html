<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</title>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        #lock { position: fixed; inset: 0; background: #1a1a1a; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .header { background: #ff4b2b; padding: 15px; text-align: center; font-weight: bold; }
        #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px; border-radius: 15px; max-width: 80%; word-wrap: break-word; }
        .sent { align-self: flex-end; background: #ff4b2b; }
        .rcvd { align-self: flex-start; background: #333; }
        .input-area { padding: 15px; background: #1e1e1e; display: flex; gap: 8px; border-top: 1px solid #333; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: none; background: #333; color: white; outline: none; text-align: center; }
        .btn { background: #ff4b2b; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; }
        .time { font-size: 0.7rem; opacity: 0.6; display: block; margin-top: 5px; }
    </style>
</head>
<body>

<div id="lock">
    <h2 style="color: white;">ğŸ”’ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</h2>
    <input type="password" id="pass" placeholder="7777">
    <br>
    <button class="btn" onclick="unlock()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="header">â¤ï¸ Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</div>

<div id="chat"></div>

<div id="mainChat" class="input-area" style="display: none;">
    <input type="text" id="text" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§...">
    <button class="btn" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']); // Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
const PASS = "7777";
const LIMIT = 24 * 60 * 60 * 1000; 
const myId = Math.random().toString(36).substr(2, 9); // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ù†Ø§ÙØ°Ø© Ù…ØªØµÙØ­

function unlock() {
    if(document.getElementById('pass').value === PASS) {
        document.getElementById('lock').style.display='none';
        document.getElementById('mainChat').style.display='flex';
        startChat();
    } else { alert("Ø®Ø·Ø£!"); }
}

function startChat() {
    // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ø³Ù… ØºØ±ÙØ© Ø«Ø§Ø¨Øª "our_private_room_7777"
    const room = gun.get('our_private_room_7777');

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙˆØ±Ø§Ù‹
    room.map().on((data, id) => {
        if (!data || !data.text) return;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª (Ø­Ø°Ù Ø¨Ø¹Ø¯ 24 Ø³Ø§Ø¹Ø©)
        const now = Date.now();
        if (now - data.time > LIMIT) return;

        // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        if (document.getElementById(id)) return;

        renderMsg(data, id);
    });
}

function send() {
    const input = document.getElementById('text');
    const txt = input.value.trim();
    if(!txt) return;

    const msgId = Math.random().toString(36).substr(2, 9);
    gun.get('our_private_room_7777').get(msgId).put({
        text: txt,
        sender: myId,
        time: Date.now()
    });

    input.value = '';
}

function renderMsg(data, id) {
    const chat = document.getElementById('chat');
    const d = document.createElement('div');
    d.id = id;
    d.className = 'msg ' + (data.sender === myId ? 'sent' : 'rcvd');
    d.innerHTML = `${data.text} <span class="time">${new Date(data.time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>`;
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
}

document.getElementById('text').addEventListener('keypress', (e) => { if(e.key === 'Enter') send(); });
</script>
</body>
</html>
