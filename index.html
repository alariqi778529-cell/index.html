<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        #lock { position: fixed; inset: 0; background: #1a1a1a; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .header { background: #ff4b2b; padding: 15px; text-align: center; font-weight: bold; font-size: 1.2rem; }
        #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px 16px; border-radius: 20px; max-width: 75%; word-wrap: break-word; line-height: 1.4; }
        .sent { align-self: flex-end; background: #ff4b2b; border-bottom-right-radius: 2px; }
        .rcvd { align-self: flex-start; background: #333; border-bottom-left-radius: 2px; }
        .time { font-size: 0.65rem; opacity: 0.7; display: block; margin-top: 5px; }
        .input-area { padding: 15px; background: #1e1e1e; display: flex; gap: 8px; border-top: 1px solid #333; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: none; background: #333; color: white; outline: none; text-align: center; }
        .btn { background: #ff4b2b; color: white; border: none; padding: 10px 22px; border-radius: 25px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="lock">
    <h2>ğŸ”’ Ù…Ø³Ø§Ø­Ø© Ø®Ø§ØµØ©</h2>
    <input type="password" id="pass" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ (7777)">
    <br>
    <button class="btn" onclick="unlock()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="header">â¤ï¸ Ù…Ø³Ø§Ø­ØªÙ†Ø§ Ø§Ù„Ø®Ø§ØµØ© â¤ï¸</div>

<div id="chat"></div>

<div id="mainChat" class="input-area" style="display: none;">
    <input type="text" id="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...">
    <button class="btn" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<script>
const PASS = "7777";
const LIMIT = 24 * 60 * 60 * 1000; // 24 Ø³Ø§Ø¹Ø©
const STORAGE_KEY = "PRIVATE_CHAT_DATA";

// ØªØ­Ø¯ÙŠØ¯ Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ØªØµÙØ­ (Ù†Ø§ÙØ°Ø© A Ø£Ùˆ Ù†Ø§ÙØ°Ø© B)
if(!sessionStorage.getItem('user_id')) {
    sessionStorage.setItem('user_id', 'user_' + Math.random().toString(36).substr(2, 4));
}
const myId = sessionStorage.getItem('user_id');

function unlock() {
    if(document.getElementById('pass').value === PASS) {
        document.getElementById('lock').style.display = 'none';
        document.getElementById('mainChat').style.display = 'flex';
        render(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
    } else { alert("Ø§Ù„Ø±Ù…Ø² Ø®Ø·Ø£!"); }
}

function send() {
    const input = document.getElementById('text');
    const content = input.value.trim();
    if(!content) return;

    const newMessage = {
        id: Date.now() + Math.random(),
        sender: myId,
        text: content,
        time: Date.now()
    };

    let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    history.push(newMessage);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history));

    input.value = '';
    render(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹ Ù„Ù„Ù…Ø±Ø³Ù„
}

function render() {
    const chatBox = document.getElementById('chat');
    const now = Date.now();
    let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Ø£ÙƒØ¨Ø± Ù…Ù† 24 Ø³Ø§Ø¹Ø©)
    const activeMessages = history.filter(m => (now - m.time) < LIMIT);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(activeMessages));

    chatBox.innerHTML = '';
    activeMessages.forEach(m => {
        const d = document.createElement('div');
        d.className = 'msg ' + (m.sender === myId ? 'sent' : 'rcvd');
        const timeStr = new Date(m.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        d.innerHTML = `${m.text} <span class="time">${timeStr}</span>`;
        chatBox.appendChild(d);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Ø§Ù„Ø³Ø­Ø± Ù‡Ù†Ø§: Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ ÙŠØ±Ø§Ù‚Ø¨ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²
window.addEventListener('storage', (e) => {
    if (e.key === STORAGE_KEY) {
        render();
    }
});

document.getElementById('text').addEventListener('keypress', (e) => {
    if(e.key === 'Enter') send();
});
</script>

</body>
</html>
